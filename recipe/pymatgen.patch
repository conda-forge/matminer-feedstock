From 684be9aea68ef1a0b96f1352b964f9609f1a8a2b Mon Sep 17 00:00:00 2001
From: Jan Janssen <jan-janssen@users.noreply.github.com>
Date: Wed, 31 Mar 2021 11:10:46 +0200
Subject: [PATCH] Patch

---
 matminer/data_retrieval/retrieve_MP.py        |  2 +-
 .../data_retrieval/tests/test_retrieve_MP.py  |  2 +-
 matminer/featurizers/bandstructure.py         |  2 +-
 matminer/featurizers/composition.py           |  3 +-
 matminer/featurizers/conversions.py           |  2 +-
 matminer/featurizers/dos.py                   |  2 +-
 matminer/featurizers/site.py                  |  7 +--
 matminer/featurizers/structure.py             | 11 ++--
 .../featurizers/tests/test_composition.py     |  3 +-
 .../featurizers/tests/test_conversions.py     |  2 +-
 matminer/featurizers/tests/test_site.py       | 62 +++++++++----------
 matminer/featurizers/tests/test_structure.py  |  6 +-
 matminer/figrecipes/tests/template_scm.json   |  2 +-
 matminer/figrecipes/tests/template_vio.json   |  2 +-
 matminer/utils/conversions.py                 |  2 +-
 matminer/utils/data.py                        |  6 +-
 matminer/utils/tests/test_conversions.py      |  2 +-
 matminer/utils/tests/test_data.py             |  2 +-
 matminer/utils/tests/test_io.py               |  2 +-
 19 files changed, 64 insertions(+), 58 deletions(-)

diff --git a/matminer/data_retrieval/retrieve_MP.py b/matminer/data_retrieval/retrieve_MP.py
index b15494bf..9a14b7f9 100644
--- a/matminer/data_retrieval/retrieve_MP.py
+++ b/matminer/data_retrieval/retrieve_MP.py
@@ -1,7 +1,7 @@
 import pandas as pd
 from matminer.data_retrieval.retrieve_base import BaseDataRetrieval
 
-from pymatgen import MPRester
+from pymatgen.ext.matproj import MPRester
 from pymatgen.ext.matproj import MPRestError
 
 __author__ = ['Saurabh Bajaj <sbajaj@lbl.gov>',
diff --git a/matminer/data_retrieval/tests/test_retrieve_MP.py b/matminer/data_retrieval/tests/test_retrieve_MP.py
index 33b30d28..a2674da8 100644
--- a/matminer/data_retrieval/tests/test_retrieve_MP.py
+++ b/matminer/data_retrieval/tests/test_retrieve_MP.py
@@ -1,7 +1,7 @@
 import unittest
 
 from matminer.data_retrieval.retrieve_MP import MPDataRetrieval
-from pymatgen import SETTINGS
+from pymatgen.core import SETTINGS
 from pymatgen.electronic_structure.bandstructure import BandStructureSymmLine, \
     BandStructure
 from pymatgen.electronic_structure.dos import CompleteDos
diff --git a/matminer/featurizers/bandstructure.py b/matminer/featurizers/bandstructure.py
index a137f60f..bdd1c350 100644
--- a/matminer/featurizers/bandstructure.py
+++ b/matminer/featurizers/bandstructure.py
@@ -9,7 +9,7 @@
 from scipy.interpolate import griddata
 
 from matminer.featurizers.base import BaseFeaturizer
-from pymatgen import Spin
+from pymatgen.electronic_structure.core import Spin
 from pymatgen.electronic_structure.bandstructure import BandStructure, \
     BandStructureSymmLine
 from pymatgen.symmetry.analyzer import SpacegroupAnalyzer
diff --git a/matminer/featurizers/composition.py b/matminer/featurizers/composition.py
index 0aa95c04..e708117a 100644
--- a/matminer/featurizers/composition.py
+++ b/matminer/featurizers/composition.py
@@ -8,7 +8,8 @@
 
 import numpy as np
 import pandas as pd
-from pymatgen import Element, MPRester
+from pymatgen.core import Element
+from pymatgen.ext.matproj import MPRester
 from pymatgen.core.composition import Composition
 from pymatgen.core.molecular_orbitals import MolecularOrbitals
 from pymatgen.core.periodic_table import get_el_sp
diff --git a/matminer/featurizers/conversions.py b/matminer/featurizers/conversions.py
index b74c7d31..8f8fc3d2 100644
--- a/matminer/featurizers/conversions.py
+++ b/matminer/featurizers/conversions.py
@@ -11,7 +11,7 @@
 
 from monty.json import MontyDecoder
 
-from pymatgen import MPRester
+from pymatgen.ext.matproj import MPRester
 from pymatgen.core.structure import IStructure
 from pymatgen.core.composition import Composition
 
diff --git a/matminer/featurizers/dos.py b/matminer/featurizers/dos.py
index 4da1e478..5cd1b68c 100644
--- a/matminer/featurizers/dos.py
+++ b/matminer/featurizers/dos.py
@@ -2,7 +2,7 @@
 from collections import OrderedDict
 from matminer.featurizers.base import BaseFeaturizer
 from matminer.featurizers.composition import BandCenter
-from pymatgen import Spin
+from pymatgen.electronic_structure.core import Spin
 from pymatgen.electronic_structure.dos import CompleteDos, FermiDos
 
 
diff --git a/matminer/featurizers/site.py b/matminer/featurizers/site.py
index d2e0f570..e274b5f0 100644
--- a/matminer/featurizers/site.py
+++ b/matminer/featurizers/site.py
@@ -40,11 +40,11 @@
 from scipy.special import sph_harm
 from scipy.spatial import ConvexHull
 from sympy.physics.wigner import wigner_3j
-from pymatgen import Structure
+from pymatgen.core import Structure
 from pymatgen.core.periodic_table import Element
 from pymatgen.analysis.local_env import LocalStructOrderParams, \
     VoronoiNN, CrystalNN, solid_angle, vol_tetra
-import pymatgen.analysis
+import pymatgen.analysis.local_env
 from pymatgen.analysis.ewald import EwaldSummation
 from pymatgen.analysis.chemenv.coordination_environments.coordination_geometry_finder \
     import LocalGeometryFinder
@@ -62,8 +62,7 @@
     dscribe, SOAP_dscribe = None, None
 
 cn_motif_op_params = {}
-with open(os.path.join(os.path.dirname(
-        pymatgen.analysis.__file__), 'cn_opt_params.yaml'), 'r') as f:
+with open(os.path.join(os.path.dirname(pymatgen.analysis.local_env.__file__), 'cn_opt_params.yaml'), 'r') as f:
     cn_motif_op_params = yaml.safe_load(f)
 cn_target_motif_op = {}
 with open(os.path.join(os.path.dirname(
diff --git a/matminer/featurizers/structure.py b/matminer/featurizers/structure.py
index 0025a39f..ef08aa47 100644
--- a/matminer/featurizers/structure.py
+++ b/matminer/featurizers/structure.py
@@ -18,7 +18,7 @@
 from scipy.stats import gaussian_kde
 from sklearn.exceptions import NotFittedError
 from monty.dev import requires
-from pymatgen import Structure, Lattice
+from pymatgen.core import Structure, Lattice
 from pymatgen.analysis import bond_valence
 from pymatgen.analysis.diffraction.xrd import XRDCalculator
 from pymatgen.analysis.dimensionality import get_dimensionality_larsen
@@ -375,6 +375,8 @@ def compute_prdf(self, s):
                 and the value is the radial distribution function for those paris of elements
         """
         # Get the composition of the array
+        s = copy(s)
+        s.remove_oxidation_states()
         composition = s.composition.fractional_composition.to_reduced_dict
 
         # Get the distances between all atoms
@@ -2191,9 +2193,10 @@ def featurize(self, strc):
 
                 # Get weight by type
                 for nn in nns:
-                    site_elem = nn['site'].specie.element \
-                        if isinstance(nn['site'].specie, Specie) else \
-                        nn['site'].specie
+                    site_elem = nn['site'].specie
+                    if hasattr(site_elem, "element"):
+                        site_elem = getattr(site_elem, "element")
+
                     elem_idx = elems.index(site_elem)
                     ordering[site_idx, elem_idx] += nn['weight']
 
diff --git a/matminer/featurizers/tests/test_composition.py b/matminer/featurizers/tests/test_composition.py
index 720948a3..1d0618f8 100644
--- a/matminer/featurizers/tests/test_composition.py
+++ b/matminer/featurizers/tests/test_composition.py
@@ -7,7 +7,8 @@
 
 import pandas as pd
 import numpy as np
-from pymatgen import Composition, MPRester
+from pymatgen.core import Composition
+from pymatgen.ext.matproj import MPRester
 from pymatgen.core.periodic_table import Specie, Element
 from pymatgen.util.testing import PymatgenTest
 
diff --git a/matminer/featurizers/tests/test_conversions.py b/matminer/featurizers/tests/test_conversions.py
index 26a4b8c2..db77bf4d 100644
--- a/matminer/featurizers/tests/test_conversions.py
+++ b/matminer/featurizers/tests/test_conversions.py
@@ -7,7 +7,7 @@
 from pandas import DataFrame, MultiIndex
 
 from pymatgen.core.structure import IStructure
-from pymatgen import Composition, Lattice, Structure, Element, SETTINGS
+from pymatgen.core import Composition, Lattice, Structure, Element, SETTINGS
 
 from matminer.featurizers.conversions import (
     StrToComposition, StructureToComposition, StructureToIStructure,
diff --git a/matminer/featurizers/tests/test_site.py b/matminer/featurizers/tests/test_site.py
index 95b245be..1360a113 100644
--- a/matminer/featurizers/tests/test_site.py
+++ b/matminer/featurizers/tests/test_site.py
@@ -2,7 +2,7 @@
 
 import numpy as np
 import pandas as pd
-from pymatgen import Structure, Lattice
+from pymatgen.core import Structure, Lattice
 from pymatgen.util.testing import PymatgenTest
 from pymatgen.analysis.local_env import VoronoiNN, JmolNN, CrystalNN
 
@@ -152,37 +152,37 @@ def test_op_site_fingerprint(self):
         self.assertEqual(len([1 for l in opsfp.feature_labels() if l.split()[0] == 'wt']), 0)
 
     def test_crystal_site_fingerprint(self):
-        with self.assertWarns(DeprecationWarning):
+        with self.assertWarns(FutureWarning):
             csf = CrystalSiteFingerprint.from_preset('ops')
-            l = csf.feature_labels()
-            t = ['wt CN_1', 'wt CN_2', 'L-shaped CN_2', 'water-like CN_2',
-                 'bent 120 degrees CN_2', 'bent 150 degrees CN_2', 'linear CN_2',
-                 'wt CN_3', 'trigonal planar CN_3', 'trigonal non-coplanar CN_3',
-                 'T-shaped CN_3', 'wt CN_4', 'square co-planar CN_4',
-                 'tetrahedral CN_4', 'rectangular see-saw-like CN_4',
-                 'see-saw-like CN_4', 'trigonal pyramidal CN_4', 'wt CN_5',
-                 'pentagonal planar CN_5', 'square pyramidal CN_5',
-                 'trigonal bipyramidal CN_5', 'wt CN_6', 'hexagonal planar CN_6',
-                 'octahedral CN_6', 'pentagonal pyramidal CN_6', 'wt CN_7',
-                 'hexagonal pyramidal CN_7', 'pentagonal bipyramidal CN_7',
-                 'wt CN_8', 'body-centered cubic CN_8',
-                 'hexagonal bipyramidal CN_8', 'wt CN_9', 'q2 CN_9', 'q4 CN_9',
-                 'q6 CN_9', 'wt CN_10', 'q2 CN_10', 'q4 CN_10', 'q6 CN_10',
-                 'wt CN_11', 'q2 CN_11', 'q4 CN_11', 'q6 CN_11', 'wt CN_12',
-                 'cuboctahedral CN_12', 'q2 CN_12', 'q4 CN_12', 'q6 CN_12']
-            for i in range(len(l)):
-                self.assertEqual(l[i], t[i])
-            ops = csf.featurize(self.sc, 0)
-            self.assertEqual(len(ops), 48)
-            self.assertAlmostEqual(ops[csf.feature_labels().index(
-                'wt CN_6')], 1, places=4)
-            self.assertAlmostEqual(ops[csf.feature_labels().index(
-                'octahedral CN_6')], 1, places=4)
-            ops = csf.featurize(self.cscl, 0)
-            self.assertAlmostEqual(ops[csf.feature_labels().index(
-                'wt CN_8')], 0.5575257, places=4)
-            self.assertAlmostEqual(ops[csf.feature_labels().index(
-                'body-centered cubic CN_8')], 0.5329344, places=4)
+        l = csf.feature_labels()
+        t = ['wt CN_1', 'wt CN_2', 'L-shaped CN_2', 'water-like CN_2',
+             'bent 120 degrees CN_2', 'bent 150 degrees CN_2', 'linear CN_2',
+             'wt CN_3', 'trigonal planar CN_3', 'trigonal non-coplanar CN_3',
+             'T-shaped CN_3', 'wt CN_4', 'square co-planar CN_4',
+             'tetrahedral CN_4', 'rectangular see-saw-like CN_4',
+             'see-saw-like CN_4', 'trigonal pyramidal CN_4', 'wt CN_5',
+             'pentagonal planar CN_5', 'square pyramidal CN_5',
+             'trigonal bipyramidal CN_5', 'wt CN_6', 'hexagonal planar CN_6',
+             'octahedral CN_6', 'pentagonal pyramidal CN_6', 'wt CN_7',
+             'hexagonal pyramidal CN_7', 'pentagonal bipyramidal CN_7',
+             'wt CN_8', 'body-centered cubic CN_8',
+             'hexagonal bipyramidal CN_8', 'wt CN_9', 'q2 CN_9', 'q4 CN_9',
+             'q6 CN_9', 'wt CN_10', 'q2 CN_10', 'q4 CN_10', 'q6 CN_10',
+             'wt CN_11', 'q2 CN_11', 'q4 CN_11', 'q6 CN_11', 'wt CN_12',
+             'cuboctahedral CN_12', 'q2 CN_12', 'q4 CN_12', 'q6 CN_12']
+        for i in range(len(l)):
+            self.assertEqual(l[i], t[i])
+        ops = csf.featurize(self.sc, 0)
+        self.assertEqual(len(ops), 48)
+        self.assertAlmostEqual(ops[csf.feature_labels().index(
+            'wt CN_6')], 1, places=4)
+        self.assertAlmostEqual(ops[csf.feature_labels().index(
+            'octahedral CN_6')], 1, places=4)
+        ops = csf.featurize(self.cscl, 0)
+        self.assertAlmostEqual(ops[csf.feature_labels().index(
+            'wt CN_8')], 0.5575257, places=4)
+        self.assertAlmostEqual(ops[csf.feature_labels().index(
+            'body-centered cubic CN_8')], 0.5329344, places=4)
 
     def test_crystal_nn_fingerprint(self):
         cnnfp = CrystalNNFingerprint.from_preset(
diff --git a/matminer/featurizers/tests/test_structure.py b/matminer/featurizers/tests/test_structure.py
index 1d7947ff..983ba5bb 100644
--- a/matminer/featurizers/tests/test_structure.py
+++ b/matminer/featurizers/tests/test_structure.py
@@ -13,7 +13,7 @@
 from multiprocessing import set_start_method
 from sklearn.exceptions import NotFittedError
 
-from pymatgen import Structure, Lattice, Molecule
+from pymatgen.core import Structure, Lattice, Molecule
 from pymatgen.util.testing import PymatgenTest
 
 from matminer.featurizers.composition import ElementProperty
@@ -511,9 +511,9 @@ def test_bob(self):
         df = pd.DataFrame({'structures': [self.cscl]})
         df = bob.featurize_dataframe(df, 'structures')
         self.assertEqual(len(df.columns.values), 25)
-        self.assertAlmostEqual(df['Cs site #0'][0], 7513.468312122532)
+        self.assertAlmostEqual(df['Cs+ site #0'][0], 7513.468312122532)
         self.assertAlmostEqual(df['Al site #0'][0], 0.0)
-        self.assertAlmostEqual(df['Cs - Cl bond #1'][0], 135.74726437398044, 3)
+        self.assertAlmostEqual(df['Cs+ - Cl- bond #1'][0], 135.74726437398044, 3)
         self.assertAlmostEqual(df['Al - Ni bond #0'][0], 0.0)
 
         # Test error handling for bad fits or null fits
diff --git a/matminer/figrecipes/tests/template_scm.json b/matminer/figrecipes/tests/template_scm.json
index acc2df5f..68f324f3 100644
--- a/matminer/figrecipes/tests/template_scm.json
+++ b/matminer/figrecipes/tests/template_scm.json
@@ -1 +1 @@
-{"height": 1000, "hoverlabel": {"font": {"family": "Courier", "size": 22.5}}, "hovermode": "closest", "legend": {"font": {"family": "Courier", "size": 22.5}}, "margin": {"b": 167.5, "l": 167.5, "pad": 0, "r": 120, "t": 120}, "paper_bgcolor": "white", "plot_bgcolor": "white", "showlegend": true, "template": {"data": {"barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "title": {"text": ""}, "width": 1300, "xaxis": {"anchor": "y", "domain": [0.0, 0.2888888888888889], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis": {"anchor": "x", "domain": [0.7333333333333333, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "0"}}, "xaxis2": {"anchor": "y2", "domain": [0.35555555555555557, 0.6444444444444445], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis2": {"anchor": "x2", "domain": [0.7333333333333333, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis3": {"anchor": "y3", "domain": [0.7111111111111111, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis3": {"anchor": "x3", "domain": [0.7333333333333333, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis4": {"anchor": "y4", "domain": [0.0, 0.2888888888888889], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis4": {"anchor": "x4", "domain": [0.36666666666666664, 0.6333333333333333], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "1"}}, "xaxis5": {"anchor": "y5", "domain": [0.35555555555555557, 0.6444444444444445], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis5": {"anchor": "x5", "domain": [0.36666666666666664, 0.6333333333333333], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis6": {"anchor": "y6", "domain": [0.7111111111111111, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis6": {"anchor": "x6", "domain": [0.36666666666666664, 0.6333333333333333], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis7": {"anchor": "y7", "domain": [0.0, 0.2888888888888889], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "0"}}, "yaxis7": {"anchor": "x7", "domain": [0.0, 0.26666666666666666], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "2"}}, "xaxis8": {"anchor": "y8", "domain": [0.35555555555555557, 0.6444444444444445], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "1"}}, "yaxis8": {"anchor": "x8", "domain": [0.0, 0.26666666666666666], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis9": {"anchor": "y9", "domain": [0.7111111111111111, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "2"}}, "yaxis9": {"anchor": "x9", "domain": [0.0, 0.26666666666666666], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}}
\ No newline at end of file
+{"height": 1000, "hoverlabel": {"font": {"family": "Courier", "size": 22.5}}, "hovermode": "closest", "legend": {"font": {"family": "Courier", "size": 22.5}}, "margin": {"b": 167.5, "l": 167.5, "pad": 0, "r": 120, "t": 120}, "paper_bgcolor": "white", "plot_bgcolor": "white", "showlegend": true, "template": {"data": {"barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "autotypenumbers": "strict", "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "title": {"text": ""}, "width": 1300, "xaxis": {"anchor": "y", "domain": [0.0, 0.2888888888888889], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis": {"anchor": "x", "domain": [0.7333333333333333, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "0"}}, "xaxis2": {"anchor": "y2", "domain": [0.35555555555555557, 0.6444444444444445], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis2": {"anchor": "x2", "domain": [0.7333333333333333, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis3": {"anchor": "y3", "domain": [0.7111111111111111, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis3": {"anchor": "x3", "domain": [0.7333333333333333, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis4": {"anchor": "y4", "domain": [0.0, 0.2888888888888889], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis4": {"anchor": "x4", "domain": [0.36666666666666664, 0.6333333333333333], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "1"}}, "xaxis5": {"anchor": "y5", "domain": [0.35555555555555557, 0.6444444444444445], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis5": {"anchor": "x5", "domain": [0.36666666666666664, 0.6333333333333333], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis6": {"anchor": "y6", "domain": [0.7111111111111111, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "yaxis6": {"anchor": "x6", "domain": [0.36666666666666664, 0.6333333333333333], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis7": {"anchor": "y7", "domain": [0.0, 0.2888888888888889], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "0"}}, "yaxis7": {"anchor": "x7", "domain": [0.0, 0.26666666666666666], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "2"}}, "xaxis8": {"anchor": "y8", "domain": [0.35555555555555557, 0.6444444444444445], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "1"}}, "yaxis8": {"anchor": "x8", "domain": [0.0, 0.26666666666666666], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}, "xaxis9": {"anchor": "y9", "domain": [0.7111111111111111, 1.0], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}, "text": "2"}}, "yaxis9": {"anchor": "x9", "domain": [0.0, 0.26666666666666666], "tickfont": {"family": "Courier", "size": 14.564267639828506}, "title": {"font": {"family": "Courier", "size": 18.06168513960519}}}}
\ No newline at end of file
diff --git a/matminer/figrecipes/tests/template_vio.json b/matminer/figrecipes/tests/template_vio.json
index 306ca91f..ba05fdad 100644
--- a/matminer/figrecipes/tests/template_vio.json
+++ b/matminer/figrecipes/tests/template_vio.json
@@ -1 +1 @@
-{"autosize": false, "font": {"family": "Courier", "size": 14.625}, "height": 1000, "hoverlabel": {"font": {"family": "Courier", "size": 22.5}}, "hovermode": "closest", "legend": {"font": {"family": "Courier", "size": 22.5}}, "margin": {"b": 167.5, "l": 167.5, "pad": 0, "r": 120, "t": 120}, "paper_bgcolor": "white", "plot_bgcolor": "white", "showlegend": false, "template": {"data": {"barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "title": {"text": ""}, "width": 1400, "xaxis": {"mirror": false, "range": [-0.1676009303470549, 0.1676009303470549], "showgrid": false, "showline": false, "showticklabels": false, "tickfont": {"family": "Courier", "size": 22.5}, "ticks": "", "title": {"font": {"family": "Courier", "size": 22.5}, "text": "low"}, "zeroline": false}, "yaxis": {"autorange": true, "mirror": false, "showgrid": false, "showline": true, "showticklabels": true, "tickfont": {"family": "Courier", "size": 22.5}, "ticklen": 4, "title": {"font": {"family": "Courier", "size": 22.5}, "text": ""}, "type": "linear", "zeroline": false}, "xaxis2": {"mirror": false, "range": [-0.17091053442979914, 0.17091053442979914], "showgrid": false, "showline": false, "showticklabels": false, "tickfont": {"family": "Courier", "size": 22.5}, "ticks": "", "title": {"font": {"family": "Courier", "size": 22.5}, "text": "med"}, "zeroline": false}, "yaxis2": {"anchor": "x2", "domain": [0.0, 1.0], "matches": "y", "showticklabels": false}, "xaxis3": {"mirror": false, "range": [-0.1573854187778303, 0.1573854187778303], "showgrid": false, "showline": false, "showticklabels": false, "tickfont": {"family": "Courier", "size": 22.5}, "ticks": "", "title": {"font": {"family": "Courier", "size": 22.5}, "text": "high"}, "zeroline": false}, "yaxis3": {"anchor": "x3", "domain": [0.0, 1.0], "matches": "y", "showticklabels": false}}
\ No newline at end of file
+{"autosize": false, "font": {"family": "Courier", "size": 14.625}, "height": 1000, "hoverlabel": {"font": {"family": "Courier", "size": 22.5}}, "hovermode": "closest", "legend": {"font": {"family": "Courier", "size": 22.5}}, "margin": {"b": 167.5, "l": 167.5, "pad": 0, "r": 120, "t": 120}, "paper_bgcolor": "white", "plot_bgcolor": "white", "showlegend": false, "template": {"data": {"barpolar": [{"marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "barpolar"}], "bar": [{"error_x": {"color": "#2a3f5f"}, "error_y": {"color": "#2a3f5f"}, "marker": {"line": {"color": "#E5ECF6", "width": 0.5}}, "type": "bar"}], "carpet": [{"aaxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "baxis": {"endlinecolor": "#2a3f5f", "gridcolor": "white", "linecolor": "white", "minorgridcolor": "white", "startlinecolor": "#2a3f5f"}, "type": "carpet"}], "choropleth": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "choropleth"}], "contourcarpet": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "contourcarpet"}], "contour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "contour"}], "heatmapgl": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmapgl"}], "heatmap": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "heatmap"}], "histogram2dcontour": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2dcontour"}], "histogram2d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "histogram2d"}], "histogram": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "histogram"}], "mesh3d": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "type": "mesh3d"}], "parcoords": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "parcoords"}], "pie": [{"automargin": true, "type": "pie"}], "scatter3d": [{"line": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter3d"}], "scattercarpet": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattercarpet"}], "scattergeo": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergeo"}], "scattergl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattergl"}], "scattermapbox": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scattermapbox"}], "scatterpolargl": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolargl"}], "scatterpolar": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterpolar"}], "scatter": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatter"}], "scatterternary": [{"marker": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "type": "scatterternary"}], "surface": [{"colorbar": {"outlinewidth": 0, "ticks": ""}, "colorscale": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "type": "surface"}], "table": [{"cells": {"fill": {"color": "#EBF0F8"}, "line": {"color": "white"}}, "header": {"fill": {"color": "#C8D4E3"}, "line": {"color": "white"}}, "type": "table"}]}, "layout": {"annotationdefaults": {"arrowcolor": "#2a3f5f", "arrowhead": 0, "arrowwidth": 1}, "autotypenumbers": "strict", "coloraxis": {"colorbar": {"outlinewidth": 0, "ticks": ""}}, "colorscale": {"diverging": [[0, "#8e0152"], [0.1, "#c51b7d"], [0.2, "#de77ae"], [0.3, "#f1b6da"], [0.4, "#fde0ef"], [0.5, "#f7f7f7"], [0.6, "#e6f5d0"], [0.7, "#b8e186"], [0.8, "#7fbc41"], [0.9, "#4d9221"], [1, "#276419"]], "sequential": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]], "sequentialminus": [[0.0, "#0d0887"], [0.1111111111111111, "#46039f"], [0.2222222222222222, "#7201a8"], [0.3333333333333333, "#9c179e"], [0.4444444444444444, "#bd3786"], [0.5555555555555556, "#d8576b"], [0.6666666666666666, "#ed7953"], [0.7777777777777778, "#fb9f3a"], [0.8888888888888888, "#fdca26"], [1.0, "#f0f921"]]}, "colorway": ["#636efa", "#EF553B", "#00cc96", "#ab63fa", "#FFA15A", "#19d3f3", "#FF6692", "#B6E880", "#FF97FF", "#FECB52"], "font": {"color": "#2a3f5f"}, "geo": {"bgcolor": "white", "lakecolor": "white", "landcolor": "#E5ECF6", "showlakes": true, "showland": true, "subunitcolor": "white"}, "hoverlabel": {"align": "left"}, "hovermode": "closest", "mapbox": {"style": "light"}, "paper_bgcolor": "white", "plot_bgcolor": "#E5ECF6", "polar": {"angularaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "radialaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "scene": {"xaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "yaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}, "zaxis": {"backgroundcolor": "#E5ECF6", "gridcolor": "white", "gridwidth": 2, "linecolor": "white", "showbackground": true, "ticks": "", "zerolinecolor": "white"}}, "shapedefaults": {"line": {"color": "#2a3f5f"}}, "ternary": {"aaxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "baxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}, "bgcolor": "#E5ECF6", "caxis": {"gridcolor": "white", "linecolor": "white", "ticks": ""}}, "title": {"x": 0.05}, "xaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}, "yaxis": {"automargin": true, "gridcolor": "white", "linecolor": "white", "ticks": "", "title": {"standoff": 15}, "zerolinecolor": "white", "zerolinewidth": 2}}}, "title": {"text": ""}, "width": 1400, "xaxis": {"mirror": false, "range": [-0.16760093034705487, 0.16760093034705487], "showgrid": false, "showline": false, "showticklabels": false, "tickfont": {"family": "Courier", "size": 22.5}, "ticks": "", "title": {"font": {"family": "Courier", "size": 22.5}, "text": "low"}, "zeroline": false}, "yaxis": {"autorange": true, "mirror": false, "showgrid": false, "showline": true, "showticklabels": true, "tickfont": {"family": "Courier", "size": 22.5}, "ticklen": 4, "title": {"font": {"family": "Courier", "size": 22.5}, "text": ""}, "type": "linear", "zeroline": false}, "xaxis2": {"mirror": false, "range": [-0.17091053442979914, 0.17091053442979914], "showgrid": false, "showline": false, "showticklabels": false, "tickfont": {"family": "Courier", "size": 22.5}, "ticks": "", "title": {"font": {"family": "Courier", "size": 22.5}, "text": "med"}, "zeroline": false}, "yaxis2": {"anchor": "x2", "domain": [0.0, 1.0], "matches": "y", "showticklabels": false}, "xaxis3": {"mirror": false, "range": [-0.1573854187778303, 0.1573854187778303], "showgrid": false, "showline": false, "showticklabels": false, "tickfont": {"family": "Courier", "size": 22.5}, "ticks": "", "title": {"font": {"family": "Courier", "size": 22.5}, "text": "high"}, "zeroline": false}, "yaxis3": {"anchor": "x3", "domain": [0.0, 1.0], "matches": "y", "showticklabels": false}}
\ No newline at end of file
diff --git a/matminer/utils/conversions.py b/matminer/utils/conversions.py
index 7a0f62d6..7058c03e 100644
--- a/matminer/utils/conversions.py
+++ b/matminer/utils/conversions.py
@@ -4,7 +4,7 @@
 from monty.dev import deprecated
 
 import pandas as pd
-from pymatgen import Composition
+from pymatgen.core import Composition
 from pymatgen.core.structure import IStructure
 
 
diff --git a/matminer/utils/data.py b/matminer/utils/data.py
index a33f53a8..7e55cb54 100644
--- a/matminer/utils/data.py
+++ b/matminer/utils/data.py
@@ -14,7 +14,7 @@
 import pandas as pd
 from glob import glob
 
-from pymatgen import Element
+from pymatgen.core import Element
 from pymatgen.core.periodic_table import _pt_data
 
 __author__ = 'Kiran Mathew, Jiming Chen, Logan Ward, Anubhav Jain, Alex Dunn'
@@ -461,7 +461,9 @@ def __init__(self, interpolate_soft=True):
     def interpolate_soft_anions(self):
         """Fill in missing parameters for oxidation states of soft anions."""
         high_electroneg = '|'.join(['O', 'Cl', 'F'])
-        subset = self.params.loc[(self.params['Atom1_valence'] == 9) & (~self.params['Atom2'].str.contains(high_electroneg))]
+        has_high = self.params['Atom2'].str.contains(high_electroneg)
+        has_high[pd.isnull(has_high)] = False
+        subset = self.params.loc[(self.params['Atom1_valence'] == 9) & (~has_high)]
         cation_subset = subset['Atom1'].unique()
         data = []
         for cation in cation_subset:
diff --git a/matminer/utils/tests/test_conversions.py b/matminer/utils/tests/test_conversions.py
index 670cd661..429cd4a2 100644
--- a/matminer/utils/tests/test_conversions.py
+++ b/matminer/utils/tests/test_conversions.py
@@ -11,7 +11,7 @@
     structure_to_oxidstructure, \
     str_to_composition, json_to_object, structure_to_composition, \
     composition_to_oxidcomposition, structure_to_istructure
-from pymatgen import Composition, Lattice, Structure, Element
+from pymatgen.core import Composition, Lattice, Structure, Element
 
 
 class TestConversions(TestCase):
diff --git a/matminer/utils/tests/test_data.py b/matminer/utils/tests/test_data.py
index 0e145f3e..1022cdd9 100644
--- a/matminer/utils/tests/test_data.py
+++ b/matminer/utils/tests/test_data.py
@@ -6,7 +6,7 @@
 
 from matminer.utils.data import DemlData, MagpieData, PymatgenData, \
     MixingEnthalpy, MatscholarElementData, MEGNetElementData, IUCrBondValenceData
-from pymatgen import Element
+from pymatgen.core import Element
 
 
 class TestDemlData(TestCase):
diff --git a/matminer/utils/tests/test_io.py b/matminer/utils/tests/test_io.py
index 68d9fa35..f26b7f7c 100644
--- a/matminer/utils/tests/test_io.py
+++ b/matminer/utils/tests/test_io.py
@@ -8,7 +8,7 @@
 
 from monty.io import zopen
 
-from pymatgen import Structure, Lattice
+from pymatgen.core import Structure, Lattice
 from pymatgen.util.testing import PymatgenTest
 
 from matminer.utils.io import load_dataframe_from_json, store_dataframe_as_json
